---
tags:
  - 图形学
  - 软光栅
---
# 图片读取

使用开源的图片读取库：stb_image来实现图片的读取。

```Cpp
//stbimage读入的图片，原点在左上角，y轴是向下生长的
//我方图形程序认为，图片应该是左下角为(0,0)，故需要翻转y轴
stbi_set_flip_vertically_on_load(true);

//由于我们是BGRA的格式，图片是RGBA的格式，所以得交换下R&B
//读取顺序是从左下角开始，向右读取，再移动到上一行。
unsigned char* bits = stbi_load(path.c_str(), &width, &height, &picType, STBI_rgb_alpha);
// 这里就是在交换R&B的色值，
// 要注意这里的色值的存储方式，是每个像素的RGBA色值，4个4个一起顺序排列的。因此，循环的时候，总次数是图片大小的4倍。
for (int i = 0; i < width * height * 4; i += 4)
{
	byte tmp = bits[i];
	bits[i] = bits[i + 2];
	bits[i + 2] = tmp;
}

// do something ...

// 释放掉三方库产生的内存！
stbi_image_free(bits);
```
# 图片显示

```Cpp
void GPU::drawImage(const Image* image, const uint32_t& x, const uint32_t& y) {
	// 色值是一行一行存储的。读取的时候，这里是按列读取的。
	for (size_t col = 0; col < image->mWidth; col++)
	{
		for (size_t row = 0; row < image->mHeight; row++)
		{
			drawPoint(col + x, row + y, image->mData[row * image->mWidth + col]);
		}
	}
}
```
