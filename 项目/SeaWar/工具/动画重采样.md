---
tags:
  - SeaWar/工具/动画重采样
  - mytodo
  - Unity/Tools/动画采样
type: Project
project: SeaWar
projectType: Task
fileDirPath: 项目/SeaWar/工具
dateStart: 2025-06-17
dateFinish: 2025-06-21
finished: false
displayIcon: pixel-banner-images/项目任务.png
---
# 需求背景
项目中，存在一个超大的动画，时长达到1min，并且是60FPS。项目本身是一个SLG类型项目，本就不需要使用60FPS这么高精度的动画。
因此，需要做一个工具，批量将项目中的60FPS动画重新采样成30FPS动画。
## 60FPS动画的影响
### **导入与工作流注意事项**
- **重采样风险**：  
    若原始动画非60FPS（如电影标准的24FPS），Unity导入时自动重采样可能引入**冗余关键帧**或**数据失真**
    **解决方法**：在导入设置中勾选 `Resample Curves` 并匹配原始帧率。Assets > Model File > Animation > Resample Curves (启用)
### **与游戏帧率的关系**
- **独立于游戏FPS**：  
    Unity动画系统基于时间而非帧更新，即使游戏运行帧率低于60FPS，60FPS动画仍能通过插值保持平滑（但无法超越游戏实际帧率）
### **最佳实践建议**
1. **按需分配帧率**：  
    关键动画（战斗/过场）用60FPS，次要动画（环境交互）用30FPS。
2. **压缩动画数据**：  
    启用动画压缩减少体积（`Animation Clip > Compression > Optimal`），注意测试是否影响精度。
3. **烘焙物理动画**：  
    对物理模拟动画（如布料），60FPS可提升真实感，但优先考虑使用`Unity.Animations.Rigging`实时驱动。
4. **测试多平台**：  
    在目标设备上Profile性能：`Window > Analysis > Profiler` 查看 `Animation.Update` 耗时。
# 需求与解决方案
## 需求
将60FPS的动画，重新采样成30FPS的动画，但是不能丢失关键帧数据。简而言之，不能直接裁剪动画，而是需要保留关键帧，同时压缩帧间隔。
## 直接修改Samples
在Animation窗口中，有帧率显示，并且可以修改，但其实，只是将动画按照设定帧率进行播放。
![[SampleRate=30.gif|420]]
![[SampleRate=15.gif|420]]
结合Animation Window展示的时长对比
## 解决方案
### 核心思想
在降低帧率的同时，确保每个原始关键帧在30FPS的动画中都有一个对应的关键帧（即使这个关键帧在30FPS的时间线上并不正好在某一帧上，我们也需要将它烘焙到最近的帧上，或者通过设置确保关键帧被保留）。
### 思路
先获取原始动画的所有关键帧，然后将这些关键帧的时间点映射到30FPS的时间线上（即每个关键帧的时间四舍五入到最近的1/30秒），然后创建一个新的动画剪辑，在四舍五入后的时间点上设置关键帧。这样，原始关键帧都会被保留（尽管可能被轻微移动），但不会因为采样率降低而丢失。

但是，我们实际上不需要改变关键帧的时间，而是需要确保在30FPS的播放速率下，每个30FPS的帧都包含一个关键帧（如果原始60FPS中在该时间点附近有关键帧的话）。这可以通过在30FPS的每个时间点上对60FPS的动画进行采样（即取值）并设置关键帧来实现。这就是烘焙动画。

更简单的方法：使用`AnimationUtility.GetAllCurves`获取所有曲线，然后对每条曲线，我们获取所有关键帧。然后，我们创建一个新的动画剪辑，并按照30FPS的时间步长（从0到动画长度，每隔1/30秒）对原始曲线进行采样，并在每个时间步长设置关键帧。这样，我们就在30FPS的帧率下烘焙了整个动画，并且原始关键帧所在的时间点会被采样，但由于我们以30FPS的间隔采样，原始关键帧可能不在采样点上，所以实际上我们丢失了原始关键帧的精确位置。因此，我们需要将原始关键帧的时间点也加入采样点，这样就能确保原始关键帧被保留。







