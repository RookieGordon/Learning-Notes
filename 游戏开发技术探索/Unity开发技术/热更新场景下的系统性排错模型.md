---
tags:
  - 思维逻辑
---
# 第一章：热更系统的五层结构

热更不是单点系统，而是五层系统：
```
┌────────────────────┐
│ 第5层：客户端运行层 │
│ (加载/解密/执行)    │
└────────────────────┘
            ▲
┌────────────────────┐
│ 第4层：资源下载层   │
│ (CDN/缓存/版本控制) │
└────────────────────┘
            ▲
┌────────────────────┐
│ 第3层：版本管理层   │
│ (白名单/配置/映射)  │
└────────────────────┘
            ▲
┌────────────────────┐
│ 第2层：构建层       │
│ (打包/加密/依赖分析)│
└────────────────────┘
            ▲
┌────────────────────┐
│ 第1层：源资源层     │
└────────────────────┘
```
---

# 第二章：热更问题的定位顺序

**永远不要从运行层直接推理。**

定位顺序应为：
```
运行异常
   ↓
确认资源文件是否正确
   ↓
确认版本映射是否正确
   ↓
确认构建是否一致
   ↓
确认源资源是否变更
```

---

# 第三章：热更常见思维坑

---

## 坑 1：认为“部分更新”

很多人默认：

> 会存在一部分资源新，一部分旧。

但实际要问：

- 版本是否全量映射？
    
- Manifest是否唯一？
    
- 资源hash是否唯一？
    

如果构建层保证一致性：

> 混合状态不可能存在。

---

## 坑 2：忽略缓存影响

```
CDN缓存
浏览器缓存
本地持久缓存
临时目录
Editor缓存
```

缓存不清，热更分析全是幻觉。

---

## 坑 3：忽略初始化顺序

特别在：

- async/await
    
- 多线程
    
- Job System
    
- 静态变量
    

时序问题非常常见。

---

## 坑 4：误以为流程一致 = 环境一致

Editor 与 真机差异来源：

- 文件路径不同
    
- StreamingAssets处理不同
    
- AssetDatabase参与
    
- 宏定义不同
    
- 初始化入口不同
    

---

# 第四章：热更排错决策树

```
      热更异常
           ↓
    是否线上也异常？
           ↓
    ┌───────┴───────┐
    │               │
   否               是
    │               │
优先怀疑模拟       进入版本验证
    │               │
    ↓               ↓
检查路径/缓存     检查Manifest
    │               │
    ↓               ↓
检查密钥读取     检查Hash一致性
    │               │
    ↓               ↓
检查初始化顺序   检查CDN文件
```

---

# 第五章：热更系统不变量清单

必须写在项目文档里：

- 构建产物Hash唯一
    
- Manifest唯一
    
- 同版本密钥唯一
    
- 相同资源不可混用
    
- 版本映射不可部分覆盖
    

任何解释若违反这些：

直接删除。