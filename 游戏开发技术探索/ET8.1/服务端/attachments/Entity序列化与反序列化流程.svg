<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than draw.io -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" style="background: transparent; background-color: transparent; color-scheme: light dark;" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="906px" height="2039px" viewBox="0 0 906 2039" content="&lt;mxfile host=&quot;app.diagrams.net&quot; agent=&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36&quot; version=&quot;29.4.0&quot;&gt;&#10;  &lt;diagram name=&quot;第 1 页&quot; id=&quot;RlA0FQwaucR2aheJ83xG&quot;&gt;&#10;    &lt;mxGraphModel dx=&quot;1152&quot; dy=&quot;795&quot; grid=&quot;1&quot; gridSize=&quot;10&quot; guides=&quot;1&quot; tooltips=&quot;1&quot; connect=&quot;1&quot; arrows=&quot;1&quot; fold=&quot;1&quot; page=&quot;1&quot; pageScale=&quot;1&quot; pageWidth=&quot;827&quot; pageHeight=&quot;1169&quot; math=&quot;0&quot; shadow=&quot;0&quot;&gt;&#10;      &lt;root&gt;&#10;        &lt;mxCell id=&quot;0&quot; /&gt;&#10;        &lt;mxCell id=&quot;1&quot; parent=&quot;0&quot; /&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-1&quot; parent=&quot;1&quot; style=&quot;shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&amp;quot;edgeStyle&amp;quot;:&amp;quot;elbowEdgeStyle&amp;quot;,&amp;quot;elbow&amp;quot;:&amp;quot;vertical&amp;quot;,&amp;quot;curved&amp;quot;:0,&amp;quot;rounded&amp;quot;:0};size=65;&quot; value=&quot;Entity 对象&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;2038&quot; width=&quot;150&quot; x=&quot;56&quot; y=&quot;20&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-2&quot; parent=&quot;1&quot; style=&quot;shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&amp;quot;edgeStyle&amp;quot;:&amp;quot;elbowEdgeStyle&amp;quot;,&amp;quot;elbow&amp;quot;:&amp;quot;vertical&amp;quot;,&amp;quot;curved&amp;quot;:0,&amp;quot;rounded&amp;quot;:0};size=65;&quot; value=&quot;BeginInit()&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;2038&quot; width=&quot;150&quot; x=&quot;261&quot; y=&quot;20&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-3&quot; parent=&quot;1&quot; style=&quot;shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&amp;quot;edgeStyle&amp;quot;:&amp;quot;elbowEdgeStyle&amp;quot;,&amp;quot;elbow&amp;quot;:&amp;quot;vertical&amp;quot;,&amp;quot;curved&amp;quot;:0,&amp;quot;rounded&amp;quot;:0};size=65;&quot; value=&quot;MongoDB Bson&amp;#xa;序列化器&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;2038&quot; width=&quot;150&quot; x=&quot;543&quot; y=&quot;20&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-4&quot; parent=&quot;1&quot; style=&quot;shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&amp;quot;edgeStyle&amp;quot;:&amp;quot;elbowEdgeStyle&amp;quot;,&amp;quot;elbow&amp;quot;:&amp;quot;vertical&amp;quot;,&amp;quot;curved&amp;quot;:0,&amp;quot;rounded&amp;quot;:0};size=65;&quot; value=&quot;MongoDB&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;2038&quot; width=&quot;150&quot; x=&quot;775&quot; y=&quot;20&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-5&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;04TV6gTA3Fbap-0r3nyX-1&quot; style=&quot;verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;&quot; target=&quot;04TV6gTA3Fbap-0r3nyX-3&quot; value=&quot;mongoCollection.ReplaceOneAsync(entity)&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;383&quot; y=&quot;179&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-6&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;04TV6gTA3Fbap-0r3nyX-3&quot; style=&quot;verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;&quot; target=&quot;04TV6gTA3Fbap-0r3nyX-2&quot; value=&quot;ISupportInitialize.BeginInit()&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;488&quot; y=&quot;235&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-7&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;04TV6gTA3Fbap-0r3nyX-2&quot; style=&quot;curved=1;endArrow=block;rounded=0;&quot; target=&quot;04TV6gTA3Fbap-0r3nyX-2&quot; value=&quot;1. EntitySystemSingleton.Serialize(this)&amp;#xa;触发ISerialize钩子&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;387&quot; y=&quot;314&quot; /&gt;&#10;              &lt;mxPoint x=&quot;387&quot; y=&quot;344&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-8&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;04TV6gTA3Fbap-0r3nyX-2&quot; style=&quot;curved=1;endArrow=block;rounded=0;&quot; target=&quot;04TV6gTA3Fbap-0r3nyX-2&quot; value=&quot;2. 遍历 components(Dict)&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;387&quot; y=&quot;400&quot; /&gt;&#10;              &lt;mxPoint x=&quot;387&quot; y=&quot;430&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-9&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;04TV6gTA3Fbap-0r3nyX-2&quot; style=&quot;curved=1;endArrow=block;rounded=0;&quot; target=&quot;04TV6gTA3Fbap-0r3nyX-2&quot; value=&quot;3. 过滤: entity is ISerializeToEntity?&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;387&quot; y=&quot;486&quot; /&gt;&#10;              &lt;mxPoint x=&quot;387&quot; y=&quot;516&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-10&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;04TV6gTA3Fbap-0r3nyX-2&quot; style=&quot;curved=1;endArrow=block;rounded=0;&quot; target=&quot;04TV6gTA3Fbap-0r3nyX-2&quot; value=&quot;4. 写入 componentsDB(List)&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;387&quot; y=&quot;572&quot; /&gt;&#10;              &lt;mxPoint x=&quot;387&quot; y=&quot;602&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-11&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;04TV6gTA3Fbap-0r3nyX-2&quot; style=&quot;curved=1;endArrow=block;rounded=0;&quot; target=&quot;04TV6gTA3Fbap-0r3nyX-2&quot; value=&quot;5. 遍历 children(Dict) → childrenDB(List)&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;387&quot; y=&quot;658&quot; /&gt;&#10;              &lt;mxPoint x=&quot;387&quot; y=&quot;688&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-12&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;04TV6gTA3Fbap-0r3nyX-2&quot; style=&quot;curved=1;endArrow=block;rounded=0;&quot; target=&quot;04TV6gTA3Fbap-0r3nyX-2&quot; value=&quot;6. 递归子实体 BeginInit()&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;387&quot; y=&quot;744&quot; /&gt;&#10;              &lt;mxPoint x=&quot;387&quot; y=&quot;774&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-13&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;04TV6gTA3Fbap-0r3nyX-2&quot; style=&quot;verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;dashPattern=2 3;endArrow=block;&quot; target=&quot;04TV6gTA3Fbap-0r3nyX-3&quot; value=&quot;准备完毕&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;485&quot; y=&quot;826&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-14&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;04TV6gTA3Fbap-0r3nyX-3&quot; style=&quot;curved=1;endArrow=block;rounded=0;&quot; target=&quot;04TV6gTA3Fbap-0r3nyX-3&quot; value=&quot;序列化字段:&amp;#xa;Id → _id&amp;#xa;componentsDB → &amp;quot;C&amp;quot;&amp;#xa;childrenDB → &amp;quot;Children&amp;quot;&amp;#xa;[BsonIgnore]字段跳过&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;669&quot; y=&quot;974&quot; /&gt;&#10;              &lt;mxPoint x=&quot;669&quot; y=&quot;1004&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-15&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;04TV6gTA3Fbap-0r3nyX-3&quot; style=&quot;verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;&quot; target=&quot;04TV6gTA3Fbap-0r3nyX-4&quot; value=&quot;Upsert 写入 MongoDB&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;742&quot; y=&quot;1060&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-16&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;04TV6gTA3Fbap-0r3nyX-4&quot; style=&quot;verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;dashPattern=2 3;endArrow=block;&quot; target=&quot;04TV6gTA3Fbap-0r3nyX-3&quot; value=&quot;返回 Bson 文档&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;745&quot; y=&quot;1164&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-17&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;04TV6gTA3Fbap-0r3nyX-3&quot; style=&quot;verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;&quot; target=&quot;04TV6gTA3Fbap-0r3nyX-1&quot; value=&quot;反序列化: _id → Id&amp;#xa;&amp;quot;C&amp;quot; → componentsDB&amp;#xa;&amp;quot;Children&amp;quot; → childrenDB&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;386&quot; y=&quot;1266&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-18&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;04TV6gTA3Fbap-0r3nyX-3&quot; style=&quot;verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;&quot; target=&quot;04TV6gTA3Fbap-0r3nyX-1&quot; value=&quot;ISupportInitialize.EndInit()&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;386&quot; y=&quot;1322&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-19&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;04TV6gTA3Fbap-0r3nyX-1&quot; style=&quot;curved=1;endArrow=block;rounded=0;&quot; target=&quot;04TV6gTA3Fbap-0r3nyX-1&quot; value=&quot;设置 IScene (添加到实体树)&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;182&quot; y=&quot;1445&quot; /&gt;&#10;              &lt;mxPoint x=&quot;182&quot; y=&quot;1475&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-20&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;04TV6gTA3Fbap-0r3nyX-1&quot; style=&quot;curved=1;endArrow=block;rounded=0;&quot; target=&quot;04TV6gTA3Fbap-0r3nyX-1&quot; value=&quot;1. 生成新 InstanceId&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;182&quot; y=&quot;1531&quot; /&gt;&#10;              &lt;mxPoint x=&quot;182&quot; y=&quot;1561&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-21&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;04TV6gTA3Fbap-0r3nyX-1&quot; style=&quot;curved=1;endArrow=block;rounded=0;&quot; target=&quot;04TV6gTA3Fbap-0r3nyX-1&quot; value=&quot;2. componentsDB → components(Dict)&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;182&quot; y=&quot;1617&quot; /&gt;&#10;              &lt;mxPoint x=&quot;182&quot; y=&quot;1647&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-22&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;04TV6gTA3Fbap-0r3nyX-1&quot; style=&quot;curved=1;endArrow=block;rounded=0;&quot; target=&quot;04TV6gTA3Fbap-0r3nyX-1&quot; value=&quot;3. childrenDB → children(Dict)&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;182&quot; y=&quot;1703&quot; /&gt;&#10;              &lt;mxPoint x=&quot;182&quot; y=&quot;1733&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-23&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;04TV6gTA3Fbap-0r3nyX-1&quot; style=&quot;curved=1;endArrow=block;rounded=0;&quot; target=&quot;04TV6gTA3Fbap-0r3nyX-1&quot; value=&quot;4. 递归设置子实体 IScene&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;182&quot; y=&quot;1789&quot; /&gt;&#10;              &lt;mxPoint x=&quot;182&quot; y=&quot;1819&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-24&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;04TV6gTA3Fbap-0r3nyX-1&quot; style=&quot;curved=1;endArrow=block;rounded=0;&quot; target=&quot;04TV6gTA3Fbap-0r3nyX-1&quot; value=&quot;5. 触发 DeserializeSystem 钩子&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;Array as=&quot;points&quot;&gt;&#10;              &lt;mxPoint x=&quot;182&quot; y=&quot;1875&quot; /&gt;&#10;              &lt;mxPoint x=&quot;182&quot; y=&quot;1905&quot; /&gt;&#10;            &lt;/Array&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-25&quot; parent=&quot;1&quot; style=&quot;fillColor=#ffff88;strokeColor=#9E916F;&quot; value=&quot;=== 保存流程 (DB.Save) ===&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;48&quot; width=&quot;769&quot; x=&quot;106&quot; y=&quot;95&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-26&quot; parent=&quot;1&quot; style=&quot;fillColor=#ffff88;strokeColor=#9E916F;&quot; value=&quot;=== 加载流程 (DB.Query) ===&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;48&quot; width=&quot;769&quot; x=&quot;106&quot; y=&quot;1080&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-27&quot; parent=&quot;1&quot; style=&quot;fillColor=#ffff88;strokeColor=#9E916F;&quot; value=&quot;此时 componentsDB 有数据&amp;#xa;但 components(Dict) 为空&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;67&quot; width=&quot;222&quot; x=&quot;20&quot; y=&quot;1342&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;04TV6gTA3Fbap-0r3nyX-28&quot; parent=&quot;1&quot; style=&quot;fillColor=#ffff88;strokeColor=#9E916F;&quot; value=&quot;Entity 完全恢复,可正常使用&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;48&quot; width=&quot;216&quot; x=&quot;23&quot; y=&quot;1925&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;      &lt;/root&gt;&#10;    &lt;/mxGraphModel&gt;&#10;  &lt;/diagram&gt;&#10;&lt;/mxfile&gt;&#10;"><defs/><g><g data-cell-id="0"><g data-cell-id="1"><g data-cell-id="04TV6gTA3Fbap-0r3nyX-1"><g transform="translate(0.5,0.5)"><rect x="36" y="0" width="150" height="65" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 111 65 L 111 2038" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="all" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 148px; height: 1px; padding-top: 33px; margin-left: 37px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Entity 对象</div></div></div></foreignObject><text x="111" y="36" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Entity 对象</text></switch></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-2"><g transform="translate(0.5,0.5)"><rect x="241" y="0" width="150" height="65" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 316 65 L 316 2038" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="all" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 148px; height: 1px; padding-top: 33px; margin-left: 242px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">BeginInit()</div></div></div></foreignObject><text x="316" y="36" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">BeginInit()</text></switch></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-3"><g transform="translate(0.5,0.5)"><rect x="523" y="0" width="150" height="65" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 598 65 L 598 2038" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="all" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 148px; height: 1px; padding-top: 33px; margin-left: 524px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">MongoDB Bson<br />序列化器</div></div></div></foreignObject><text x="598" y="36" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">MongoDB Bson...</text></switch></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-4"><g transform="translate(0.5,0.5)"><rect x="755" y="0" width="150" height="65" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 830 65 L 830 2038" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="all" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 148px; height: 1px; padding-top: 33px; margin-left: 756px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">MongoDB</div></div></div></foreignObject><text x="830" y="36" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">MongoDB</text></switch></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-5"><g transform="translate(0.5,0.5)"><path d="M 110.5 159 L 363 159 L 589.38 159" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 596.38 159 L 589.38 162.5 L 589.38 155.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="11px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><rect fill="#ffffff" stroke="none" x="249" y="144" width="212" height="14" stroke-width="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><text x="354.5" y="154">mongoCollection.ReplaceOneAsync(entity)</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-6"><g transform="translate(0.5,0.5)"><path d="M 597.5 215 L 468 215 L 323.62 215" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 316.62 215 L 323.62 211.5 L 323.62 218.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="11px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><rect fill="#ffffff" stroke="none" x="389" y="200" width="137" height="14" stroke-width="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><text x="456.5" y="210">ISupportInitialize.BeginInit()</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-7"><g transform="translate(0.5,0.5)"><path d="M 315.5 294 Q 367 294 367 309 Q 367 324 323.62 324" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 316.62 324 L 323.62 320.5 L 323.62 327.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="11px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><rect fill="#ffffff" stroke="none" x="271" y="297" width="194" height="27" stroke-width="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><text x="367" y="307.5">1. EntitySystemSingleton.Serialize(this)</text><text x="367" y="320.5">触发ISerialize钩子</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-8"><g transform="translate(0.5,0.5)"><path d="M 315.5 380 Q 367 380 367 395 Q 367 410 323.62 410" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 316.62 410 L 323.62 406.5 L 323.62 413.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="11px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><rect fill="#ffffff" stroke="none" x="305" y="390" width="125" height="14" stroke-width="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><text x="367" y="400">2. 遍历 components(Dict)</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-9"><g transform="translate(0.5,0.5)"><path d="M 315.5 466 Q 367 466 367 481 Q 367 496 323.62 496" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 316.62 496 L 323.62 492.5 L 323.62 499.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="11px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><rect fill="#ffffff" stroke="none" x="281" y="476" width="173" height="14" stroke-width="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><text x="367" y="486">3. 过滤: entity is ISerializeToEntity?</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-10"><g transform="translate(0.5,0.5)"><path d="M 315.5 552 Q 367 552 367 567 Q 367 582 323.62 582" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 316.62 582 L 323.62 578.5 L 323.62 585.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="11px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><rect fill="#ffffff" stroke="none" x="298" y="562" width="139" height="14" stroke-width="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><text x="367" y="572">4. 写入 componentsDB(List)</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-11"><g transform="translate(0.5,0.5)"><path d="M 315.5 638 Q 367 638 367 653 Q 367 668 323.62 668" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 316.62 668 L 323.62 664.5 L 323.62 671.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="11px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><rect fill="#ffffff" stroke="none" x="268" y="648" width="199" height="14" stroke-width="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><text x="367" y="658">5. 遍历 children(Dict) → childrenDB(List)</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-12"><g transform="translate(0.5,0.5)"><path d="M 315.5 724 Q 367 724 367 739 Q 367 754 323.62 754" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 316.62 754 L 323.62 750.5 L 323.62 757.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="11px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><rect fill="#ffffff" stroke="none" x="307" y="734" width="122" height="14" stroke-width="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><text x="367" y="744">6. 递归子实体 BeginInit()</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-13"><g transform="translate(0.5,0.5)"><path d="M 315.5 806 L 465 806 L 589.38 806" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="2 3" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 596.38 806 L 589.38 809.5 L 589.38 802.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="11px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><rect fill="#ffffff" stroke="none" x="434" y="791" width="46" height="14" stroke-width="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><text x="456.5" y="801">准备完毕</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-14"><g transform="translate(0.5,0.5)"><path d="M 597.5 954 Q 649 954 649 969 Q 649 984 605.62 984" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 598.62 984 L 605.62 980.5 L 605.62 987.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="11px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><rect fill="#ffffff" stroke="none" x="589" y="937" width="122" height="67" stroke-width="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><text x="649" y="948">序列化字段:</text><text x="649" y="961">Id → _id</text><text x="649" y="974">componentsDB → "C"</text><text x="649" y="987">childrenDB → "Children"</text><text x="649" y="1000">[BsonIgnore]字段跳过</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-15"><g transform="translate(0.5,0.5)"><path d="M 597.5 1040 L 722 1040 L 821.38 1040" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 828.38 1040 L 821.38 1043.5 L 821.38 1036.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="11px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><rect fill="#ffffff" stroke="none" x="659" y="1025" width="111" height="14" stroke-width="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><text x="713.5" y="1035">Upsert 写入 MongoDB</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-16"><g transform="translate(0.5,0.5)"><path d="M 829.5 1144 L 725 1144 L 605.62 1144" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="2 3" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 598.62 1144 L 605.62 1140.5 L 605.62 1147.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="11px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><rect fill="#ffffff" stroke="none" x="676" y="1129" width="77" height="14" stroke-width="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><text x="713.5" y="1139">返回 Bson 文档</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-17"><g transform="translate(0.5,0.5)"><path d="M 597.5 1246 L 366 1246 L 118.62 1246" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 111.62 1246 L 118.62 1242.5 L 118.62 1249.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="11px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><rect fill="#ffffff" stroke="none" x="293" y="1204" width="122" height="41" stroke-width="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><text x="353.5" y="1215">反序列化: _id → Id</text><text x="353.5" y="1228">"C" → componentsDB</text><text x="353.5" y="1241">"Children" → childrenDB</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-18"><g transform="translate(0.5,0.5)"><path d="M 597.5 1302 L 366 1302 L 118.62 1302" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 111.62 1302 L 118.62 1298.5 L 118.62 1305.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="11px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><rect fill="#ffffff" stroke="none" x="290" y="1287" width="128" height="14" stroke-width="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><text x="353.5" y="1297">ISupportInitialize.EndInit()</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-19"><g transform="translate(0.5,0.5)"><path d="M 110.5 1425 Q 162 1425 162 1440 Q 162 1455 118.62 1455" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 111.62 1455 L 118.62 1451.5 L 118.62 1458.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="11px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><rect fill="#ffffff" stroke="none" x="94" y="1435" width="138" height="14" stroke-width="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><text x="162" y="1445">设置 IScene (添加到实体树)</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-20"><g transform="translate(0.5,0.5)"><path d="M 110.5 1511 Q 162 1511 162 1526 Q 162 1541 118.62 1541" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 111.62 1541 L 118.62 1537.5 L 118.62 1544.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="11px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><rect fill="#ffffff" stroke="none" x="112" y="1521" width="101" height="14" stroke-width="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><text x="162" y="1531">1. 生成新 InstanceId</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-21"><g transform="translate(0.5,0.5)"><path d="M 110.5 1597 Q 162 1597 162 1612 Q 162 1627 118.62 1627" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 111.62 1627 L 118.62 1623.5 L 118.62 1630.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="11px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><rect fill="#ffffff" stroke="none" x="66" y="1607" width="193" height="14" stroke-width="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><text x="162" y="1617">2. componentsDB → components(Dict)</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-22"><g transform="translate(0.5,0.5)"><path d="M 110.5 1683 Q 162 1683 162 1698 Q 162 1713 118.62 1713" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 111.62 1713 L 118.62 1709.5 L 118.62 1716.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="11px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><rect fill="#ffffff" stroke="none" x="88" y="1693" width="150" height="14" stroke-width="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><text x="162" y="1703">3. childrenDB → children(Dict)</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-23"><g transform="translate(0.5,0.5)"><path d="M 110.5 1769 Q 162 1769 162 1784 Q 162 1799 118.62 1799" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 111.62 1799 L 118.62 1795.5 L 118.62 1802.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="11px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><rect fill="#ffffff" stroke="none" x="98" y="1779" width="129" height="14" stroke-width="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><text x="162" y="1789">4. 递归设置子实体 IScene</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-24"><g transform="translate(0.5,0.5)"><path d="M 110.5 1855 Q 162 1855 162 1870 Q 162 1885 118.62 1885" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 111.62 1885 L 118.62 1881.5 L 118.62 1888.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="11px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><rect fill="#ffffff" stroke="none" x="85" y="1865" width="155" height="14" stroke-width="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><text x="162" y="1875">5. 触发 DeserializeSystem 钩子</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-25"><g transform="translate(0.5,0.5)"><rect x="86" y="75" width="769" height="48" fill="#ffff88" stroke="#9e916f" pointer-events="all" style="fill: light-dark(rgb(255, 255, 136), rgb(33, 33, 0)); stroke: light-dark(rgb(158, 145, 111), rgb(123, 112, 82));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><text x="470.5" y="104">=== 保存流程 (DB.Save) ===</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-26"><g transform="translate(0.5,0.5)"><rect x="86" y="1060" width="769" height="48" fill="#ffff88" stroke="#9e916f" pointer-events="all" style="fill: light-dark(rgb(255, 255, 136), rgb(33, 33, 0)); stroke: light-dark(rgb(158, 145, 111), rgb(123, 112, 82));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><text x="470.5" y="1089">=== 加载流程 (DB.Query) ===</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-27"><g transform="translate(0.5,0.5)"><rect x="0" y="1322" width="222" height="67" fill="#ffff88" stroke="#9e916f" pointer-events="all" style="fill: light-dark(rgb(255, 255, 136), rgb(33, 33, 0)); stroke: light-dark(rgb(158, 145, 111), rgb(123, 112, 82));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><text x="111" y="1353.5">此时 componentsDB 有数据</text><text x="111" y="1367.5">但 components(Dict) 为空</text></g></g></g><g data-cell-id="04TV6gTA3Fbap-0r3nyX-28"><g transform="translate(0.5,0.5)"><rect x="3" y="1905" width="216" height="48" fill="#ffff88" stroke="#9e916f" pointer-events="all" style="fill: light-dark(rgb(255, 255, 136), rgb(33, 33, 0)); stroke: light-dark(rgb(158, 145, 111), rgb(123, 112, 82));"/></g><g><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><text x="111" y="1934">Entity 完全恢复,可正常使用</text></g></g></g></g></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.drawio.com/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>