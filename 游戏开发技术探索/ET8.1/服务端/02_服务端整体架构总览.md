---
tags:
  - ET8/框架介绍/服务器架构
---

# 架构全景图

```
┌──────────────────────────────────────────────────────────────┐
│                     World (进程级全局管理)                      │
│   FiberManager / OpcodeType / NetServices / CodeTypes ...     │
├──────────────────────────────────────────────────────────────┤
│ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐        │
│ │Main Fiber│ │NetInner  │ │ Realm    │ │  Gate    │ ...     │
│ │  (入口)   │ │Fiber     │ │ Fiber    │ │  Fiber   │        │
│ │          │ │(内网通信) │ │(登录验证) │ │ (网关)    │        │
│ └──────────┘ └──────────┘ └──────────┘ └──────────┘        │
│ ┌──────────┐ ┌──────────┐ ┌──────────┐                     │
│ │Location  │ │   Map    │ │  Match   │ ...                  │
│ │Fiber     │ │  Fiber   │ │  Fiber   │                     │
│ │(位置服务) │ │ (地图)    │ │ (匹配)   │                     │
│ └──────────┘ └──────────┘ └──────────┘                     │
│                                                              │
│           MessageQueue (Fiber间消息队列)                       │
├──────────────────────────────────────────────────────────────┤
│                  Network Layer                                │
│     KService(KCP/UDP)  TService(TCP)  WService(WebSocket)    │
└──────────────────────────────────────────────────────────────┘
      ↑↓ 客户端连接              ↑↓ 进程间连接
```

# 分层说明

| 层次 | 职责 | 关键类 |
|------|------|--------|
| **World 层** | 进程级全局单例管理 | `World`, `Singleton<T>`, `FiberManager` |
| **Fiber 层** | 独立执行上下文，每个 Fiber 有自己的 Update 循环 | `Fiber`, `EntitySystem`, `Mailboxes` |
| **Entity 层** | 业务数据和逻辑的载体（ECS 模式） | `Entity`, `Scene`, `Component` |
| **Actor 层** | 基于 MailBox 的消息驱动模型 | `MailBoxComponent`, `MessageDispatcher`, `IMHandler` |
| **通信层** | 进程内/跨进程消息路由 | `ProcessInnerSender`, `MessageSender`, `ProcessOuterSender` |
| **网络层** | 底层传输协议 | `KService`, `TService`, `WService`, `AChannel` |

# 关键设计哲学

> **"单线程多进程"** — 每个 Fiber 内部是单线程的（避免锁），多个 Fiber 并行执行（提升吞吐）。这是 ET 最核心的设计思想，贯穿所有子系统。

---
