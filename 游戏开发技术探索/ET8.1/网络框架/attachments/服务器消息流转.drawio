<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" version="29.4.0">
  <diagram name="服务器消息收发" id="server-msg-flow">
    <mxGraphModel dx="1355" dy="935" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="3500" pageHeight="2200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="bg_gate" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;opacity=30;" value="" vertex="1">
          <mxGeometry height="1570" width="1450" x="10" y="30" as="geometry" />
        </mxCell>
        <mxCell id="lbl_gate" parent="1" style="text;html=1;align=center;verticalAlign=middle;fontSize=24;fontStyle=1;" value="Gate Fiber" vertex="1">
          <mxGeometry height="40" width="170" x="630" y="40" as="geometry" />
        </mxCell>
        <mxCell id="bg_map" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;opacity=30;" value="" vertex="1">
          <mxGeometry height="1570" width="870" x="1660" y="30" as="geometry" />
        </mxCell>
        <mxCell id="lbl_map" parent="1" style="text;html=1;align=center;verticalAlign=middle;fontSize=24;fontStyle=1;" value="Map Fiber" vertex="1">
          <mxGeometry height="40" width="140" x="2020" y="40" as="geometry" />
        </mxCell>
        <mxCell id="bg_mq" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;opacity=20;" value="" vertex="1">
          <mxGeometry height="1570" width="180" x="1470" y="30" as="geometry" />
        </mxCell>
        <mxCell id="p1_head" parent="1" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" value="" vertex="1">
          <mxGeometry height="50" width="30" x="65" y="85" as="geometry" />
        </mxCell>
        <mxCell id="p2" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fontSize=11;" value=":NetComponent" vertex="1">
          <mxGeometry height="40" width="160" x="160" y="100" as="geometry" />
        </mxCell>
        <mxCell id="p3" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fontSize=11;" value=":Session" vertex="1">
          <mxGeometry height="40" width="120" x="360" y="100" as="geometry" />
        </mxCell>
        <mxCell id="p4" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fontSize=10;" value=":NetComponentOnRead&lt;br&gt;Invoker_Gate" vertex="1">
          <mxGeometry height="40" width="200" x="510" y="100" as="geometry" />
        </mxCell>
        <mxCell id="p5" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fontSize=10;" value=":MessageSession&lt;br&gt;Dispatcher" vertex="1">
          <mxGeometry height="40" width="170" x="740" y="100" as="geometry" />
        </mxCell>
        <mxCell id="p6" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fontSize=10;" value=":MessageSession&lt;br&gt;Handler" vertex="1">
          <mxGeometry height="40" width="170" x="940" y="100" as="geometry" />
        </mxCell>
        <mxCell id="p7" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fontSize=10;" value=":ProcessInnerSender&lt;br&gt;(Gate Fiber)" vertex="1">
          <mxGeometry height="40" width="180" x="1140" y="100" as="geometry" />
        </mxCell>
        <mxCell id="p8" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fontSize=11;fillColor=#dae8fc;strokeColor=#6c8ebf;" value=":MessageQueue" vertex="1">
          <mxGeometry height="40" width="150" x="1480" y="100" as="geometry" />
        </mxCell>
        <mxCell id="p9" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fontSize=10;" value=":ProcessInnerSender&lt;br&gt;(Map Fiber)" vertex="1">
          <mxGeometry height="40" width="180" x="1680" y="100" as="geometry" />
        </mxCell>
        <mxCell id="p10" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fontSize=10;" value=":MailBoxComponent" vertex="1">
          <mxGeometry height="40" width="160" x="1900" y="100" as="geometry" />
        </mxCell>
        <mxCell id="p11" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fontSize=10;" value=":MessageDispatcher" vertex="1">
          <mxGeometry height="40" width="160" x="2100" y="100" as="geometry" />
        </mxCell>
        <mxCell id="p12" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fontSize=10;" value=":MessageHandler" vertex="1">
          <mxGeometry height="40" width="160" x="2300" y="100" as="geometry" />
        </mxCell>
        <mxCell id="ll1" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=3 3;strokeWidth=1;strokeColor=#999999;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="80" y="140" as="sourcePoint" />
            <mxPoint x="80" y="1560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ll2" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=3 3;strokeWidth=1;strokeColor=#999999;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="240" y="140" as="sourcePoint" />
            <mxPoint x="240" y="1560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ll3" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=3 3;strokeWidth=1;strokeColor=#999999;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="420" y="140" as="sourcePoint" />
            <mxPoint x="420" y="1560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ll4" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=3 3;strokeWidth=1;strokeColor=#999999;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="610" y="140" as="sourcePoint" />
            <mxPoint x="610" y="1560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ll5" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=3 3;strokeWidth=1;strokeColor=#999999;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="825" y="140" as="sourcePoint" />
            <mxPoint x="825" y="1560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ll6" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=3 3;strokeWidth=1;strokeColor=#999999;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1025" y="140" as="sourcePoint" />
            <mxPoint x="1025" y="1560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ll7" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=3 3;strokeWidth=1;strokeColor=#999999;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1230" y="140" as="sourcePoint" />
            <mxPoint x="1230" y="1560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ll8" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=3 3;strokeWidth=1;strokeColor=#999999;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1555" y="140" as="sourcePoint" />
            <mxPoint x="1555" y="1560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ll9" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=3 3;strokeWidth=1;strokeColor=#999999;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1770" y="140" as="sourcePoint" />
            <mxPoint x="1770" y="1560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ll10" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=3 3;strokeWidth=1;strokeColor=#999999;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1980" y="140" as="sourcePoint" />
            <mxPoint x="1980" y="1560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ll11" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=3 3;strokeWidth=1;strokeColor=#999999;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2180" y="140" as="sourcePoint" />
            <mxPoint x="2180" y="1560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ll12" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=3 3;strokeWidth=1;strokeColor=#999999;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2380" y="140" as="sourcePoint" />
            <mxPoint x="2380" y="1560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg60" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;endFill=1;curved=0;rounded=0;fontSize=10;" value="TCP/KCP 发送请求消息">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="80" y="200" as="sourcePoint" />
            <mxPoint x="240" y="200" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg61" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;endFill=1;curved=0;rounded=0;fontSize=10;" value="ReadCallback 反序列化消息">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="240" y="250" as="sourcePoint" />
            <mxPoint x="420" y="250" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg62" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;endFill=1;curved=0;rounded=0;fontSize=10;" value="Invoke(SceneType.Gate, NetComponentOnRead)">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="420" y="300" as="sourcePoint" />
            <mxPoint x="610" y="300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="alt_frame" parent="1" style="shape=umlFrame;whiteSpace=wrap;html=1;width=50;height=25;fontSize=12;fontStyle=1;fillColor=none;pointerEvents=0;" value="Alt" vertex="1">
          <mxGeometry height="1180" width="1990" x="500" y="340" as="geometry" />
        </mxCell>
        <mxCell id="guard1" parent="1" style="text;html=1;align=left;fontSize=11;fontStyle=2;" value="[ISessionMessage]" vertex="1">
          <mxGeometry height="20" width="160" x="560" y="365" as="geometry" />
        </mxCell>
        <mxCell id="alt_sep" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;dashPattern=8 4;strokeWidth=1;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="500" y="710" as="sourcePoint" />
            <mxPoint x="2490" y="710" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="guard2" parent="1" style="text;html=1;align=left;fontSize=11;fontStyle=2;" value="[ILocationRequest]" vertex="1">
          <mxGeometry height="20" width="170" x="510" y="718" as="geometry" />
        </mxCell>
        <mxCell id="msg63" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;endFill=1;curved=0;rounded=0;fontSize=10;" value="Handle(session, message)">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="610" y="410" as="sourcePoint" />
            <mxPoint x="825" y="410" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg64" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;endFill=1;curved=0;rounded=0;fontSize=10;" value="HandleAsync()">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="825" y="460" as="sourcePoint" />
            <mxPoint x="1025" y="460" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg65" edge="1" parent="1" style="html=1;verticalAlign=middle;endArrow=block;endFill=1;curved=0;rounded=0;fontSize=10;align=left;" value="Run(session, request, response)">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1120" y="500" />
              <mxPoint x="1120" y="540" />
            </Array>
            <mxPoint x="1025" y="500" as="sourcePoint" />
            <mxPoint x="1025" y="540" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg66" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;endFill=1;curved=0;rounded=0;fontSize=10;" value="session.Send(response)">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1025" y="590" as="sourcePoint" />
            <mxPoint x="420" y="590" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg67" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;endFill=1;curved=0;rounded=0;fontSize=10;" value="序列化, AService.Send()">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="420" y="640" as="sourcePoint" />
            <mxPoint x="240" y="640" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg68" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=open;endFill=0;dashed=1;curved=0;rounded=0;fontSize=10;" value="TCP/KCP 返回响应">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="240" y="680" as="sourcePoint" />
            <mxPoint x="80" y="680" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg70" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;endFill=1;curved=0;rounded=0;fontSize=10;" value="MessageLocationSender.Call()&lt;br&gt;→ MessageSender.Call()">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="610" y="780" as="sourcePoint" />
            <mxPoint x="1230" y="780" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="note70" parent="1" style="text;html=0;align=left;fontSize=9;fontStyle=2;fontColor=#888888;" value="实际经过 MessageLocationSenderOneType&#xa;→ MessageSender → ProcessInnerSender" vertex="1">
          <mxGeometry height="25" width="300" x="690" y="754" as="geometry" />
        </mxCell>
        <mxCell id="msg71" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;endFill=1;curved=0;rounded=0;fontSize=10;" value="SendInner">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1230" y="830" as="sourcePoint" />
            <mxPoint x="1555" y="830" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg72" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;endFill=1;curved=0;rounded=0;fontSize=10;" value="取出消息列表">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1555" y="880" as="sourcePoint" />
            <mxPoint x="1770" y="880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg73" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;endFill=1;curved=0;rounded=0;fontSize=10;" value="MailBoxComponent.Add(fromAddr, msg)">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1770" y="930" as="sourcePoint" />
            <mxPoint x="1980" y="930" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg74" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;endFill=1;curved=0;rounded=0;fontSize=10;" value="Invoke(MailBoxType)&lt;br&gt;→ MessageDispatcher.Handle()">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1980" y="980" as="sourcePoint" />
            <mxPoint x="2180" y="980" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg75" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;endFill=1;curved=0;rounded=0;fontSize=10;" value="HandleAsync()">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2180" y="1030" as="sourcePoint" />
            <mxPoint x="2380" y="1030" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg76" edge="1" parent="1" style="html=1;verticalAlign=middle;endArrow=block;endFill=1;curved=0;rounded=0;fontSize=10;align=left;" value="Run(entity, request, response)">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2450" y="1070" />
              <mxPoint x="2450" y="1110" />
            </Array>
            <mxPoint x="2380" y="1070" as="sourcePoint" />
            <mxPoint x="2380" y="1110" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg77" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;endFill=1;curved=0;rounded=0;fontSize=10;" value="ProcessInnerSender.Reply(fromAddr, response)">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2380" y="1170" as="sourcePoint" />
            <mxPoint x="1770" y="1170" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg78" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;endFill=1;curved=0;rounded=0;fontSize=10;" value="SendInner">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1770" y="1220" as="sourcePoint" />
            <mxPoint x="1555" y="1220" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg79" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;endFill=1;curved=0;rounded=0;fontSize=10;" value="取出响应消息">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1555" y="1270" as="sourcePoint" />
            <mxPoint x="1230" y="1270" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg80" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=open;endFill=0;dashed=1;curved=0;rounded=0;fontSize=10;" value="HandleIActorResponse&lt;br&gt;设置RpcInfo完成, await返回IResponse">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1230" y="1320" as="sourcePoint" />
            <mxPoint x="610" y="1320" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg81" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;endFill=1;curved=0;rounded=0;fontSize=10;" value="恢复客户端RpcId, session.Send(iResponse)">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="610" y="1380" as="sourcePoint" />
            <mxPoint x="420" y="1380" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg82" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=block;endFill=1;curved=0;rounded=0;fontSize=10;" value="序列化, AService.Send()">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="420" y="1430" as="sourcePoint" />
            <mxPoint x="240" y="1430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg83" edge="1" parent="1" style="html=1;verticalAlign=bottom;endArrow=open;endFill=0;dashed=1;curved=0;rounded=0;fontSize=10;" value="TCP/KCP 返回响应">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="240" y="1480" as="sourcePoint" />
            <mxPoint x="80" y="1480" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="note_session" parent="1" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;size=12;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;" value="Gate 直接处理的请求（如 C2G_LoginGate）。&lt;br&gt;Handler 内部直接调用 session.Send(response) 回复客户端。" vertex="1">
          <mxGeometry height="40" width="340" x="560" y="385" as="geometry" />
        </mxCell>
        <mxCell id="note_location" parent="1" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;size=12;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=5;" value="转发到 Map 的请求（如客户端发给 Map 上 Unit 的消息）。&lt;br&gt;Gate 保存客户端 RpcId → 转发至 Map → Map 处理返回 → Gate 恢复 RpcId 后回复客户端。" vertex="1">
          <mxGeometry height="40" width="440" x="560" y="738" as="geometry" />
        </mxCell>
        <mxCell id="note_cross" parent="1" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;size=12;fontSize=10;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=5;" value="注: 跨进程通信时，MessageSender 会将消息封装为 A2NetInner_Request，&lt;br&gt;通过 NetInner Fiber 的 ProcessOuterSender 经 TCP 发送到目标进程。&lt;br&gt;本图仅展示同进程内 Fiber 间通信（经 MessageQueue）。" vertex="1">
          <mxGeometry height="55" width="430" x="10" y="1600" as="geometry" />
        </mxCell>
        <mxCell id="note_mq" parent="1" style="text;html=1;align=center;verticalAlign=top;fontSize=9;fontStyle=2;fontColor=#6c8ebf;" value="跨Fiber共享&lt;br&gt;(ConcurrentQueue)" vertex="1">
          <mxGeometry height="30" width="150" x="1480" y="145" as="geometry" />
        </mxCell>
        <mxCell id="legend_title" parent="1" style="text;html=1;align=left;fontSize=14;fontStyle=1;" value="图例说明" vertex="1">
          <mxGeometry height="30" width="100" x="500" y="1600" as="geometry" />
        </mxCell>
        <mxCell id="leg_sync" edge="1" parent="1" style="endArrow=block;endFill=1;html=1;fontSize=10;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="510" y="1645" as="sourcePoint" />
            <mxPoint x="610" y="1645" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="leg_sync_lbl" parent="1" style="text;html=1;align=left;fontSize=10;" value="同步方法调用" vertex="1">
          <mxGeometry height="20" width="100" x="620" y="1633" as="geometry" />
        </mxCell>
        <mxCell id="leg_ret" edge="1" parent="1" style="endArrow=open;endFill=0;dashed=1;html=1;fontSize=10;" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="510" y="1675" as="sourcePoint" />
            <mxPoint x="610" y="1675" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="leg_ret_lbl" parent="1" style="text;html=1;align=left;fontSize=10;" value="返回 / 网络响应 / 异步回调" vertex="1">
          <mxGeometry height="20" width="200" x="620" y="1663" as="geometry" />
        </mxCell>
        <mxCell id="leg_items" parent="1" style="text;html=1;align=left;fontSize=10;verticalAlign=top;spacingTop=5;" value="&lt;b&gt;ISessionMessage&lt;/b&gt;: Gate 直接处理并回复的请求（不经过其他 Fiber），如 C2G_LoginGate&lt;br&gt;&lt;b&gt;ILocationRequest&lt;/b&gt;: 需转发到目标 Fiber（如 Map）处理的请求，通过 Location 系统路由&lt;br&gt;&lt;b&gt;MessageQueue&lt;/b&gt;: 线程安全的 ConcurrentQueue，同进程跨 Fiber 消息传递&lt;br&gt;&lt;b&gt;ProcessInnerSender&lt;/b&gt;: 每个 Fiber 都有，负责同进程 Fiber 间消息投递（SendInner）和接收（HandleMessage）&lt;br&gt;&lt;b&gt;MailBoxComponent&lt;/b&gt;: Actor 信箱，收到消息后按 MailBoxType 分发（OrderedMessage / GateSession 等）&lt;br&gt;&lt;b&gt;RpcId 流转&lt;/b&gt;: Gate 保存客户端 rpcId → 转发时使用内部 rpcId → Map 返回时带内部 rpcId → Gate 恢复客户端 rpcId" vertex="1">
          <mxGeometry height="120" width="590" x="500" y="1695" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
