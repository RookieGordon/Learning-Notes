---
link: https://blog.csdn.net/weixin_44651073/article/details/124480398
byline: 成就一亿技术人!
excerpt: 文章浏览阅读1.2k次，点赞2次，收藏2次。虚函数和多态==============================================
  1.多态的概念    字面上理解：多种表现形式    专业术语：C++允许父类的指针或者父类引用指向不同的子类对象，通过这个指针或者引用去调用不同子类的同名方法--》叫做多态        父类的同名函数在不同的子类中具有不同的表现形式--》叫做多态    多态要解决的两个问题：       问题一：参数具有通用性   ..._c++
  多个基类虚函数同名子类如何实现的问题
tags:
  - slurp/c++-多个基类虚函数同名子类如何实现的问题
slurped: 2024-06-19T04:01:37.126Z
title: 第四十篇，C++虚函数底层实现原理和多态的实现。_c++ 多个基类虚函数同名子类如何实现的问题-CSDN博客
---

# 虚函数和多态  

## 多态的概念  

字面上理解：多种表现形式  

专业术语：C++允许父类的指针或者父类引用指向不同的子类对象，通过这个指针或者引用去调用不同子类的同名方法-->叫做多态  
 
父类的同名函数在不同的子类中具有不同的表现形式-->叫做多态

多态要解决的两个问题
- 参数具有通用性  
	解决方法：C++允许父类的指针或者父类引用指向不同的子类对象(不需要做任何转换)  
- 传递不同的子类，可以调用不同子类的同名函数

## 用虚函数来实现多态  

虚函数的语法规则：在普通函数的前面加上关键字virtual  

```CPP
virtual 返回值  函数名(参数)  
{
	代码；  
}
```

## 虚函数的特点，虚函数的底层原理  

### 虚函数的特点  

第一：一个类定义了虚函数，这个类的地址空间中会多出一个指针，该指针用来指向`虚函数表`的首地址。`虚函数表（虚表）`：用来存放所有虚函数地址的一种数据结构，你写的代码中所有的虚函数都是存储在这个表里面的  

第二：父类的同名函数定义成虚函数，那么子类的同名也是虚函数，子类的同名函数virtual可以省略(可写可不写)

### 虚函数的底层原理(面试的时候喜欢问)  

子类的同名虚函数会替换掉虚表中父类的同名虚函数  
重写/复写：子类重新定义了父类的同名方法

### **重点：虚函数原理实现代码和内存变化演示**

简单地说，有一些结论我们可以记住：
- 虚函数表就是一个指针数组，里面存放着函数地址指针。即每一个含有虚函数（无论是其本身的，还是继承而来的）的类都至少有一个与之对应的虚函数表，其中存放着该类所有的虚函数对应的函数指针。
- 父类定义了虚函数，子类的同名函数也是虚函数，但是子类的virtual可以省略不写。
- 父类创建一个指针指向虚函数表，表里面存储着父类的虚函数地址指针，子类不会再在创建指针，与父类共用一个指针。编译器发现子类复写了父类的同名函数，会将子类的同名函数地址替换掉虚函数表中的父类同名函数地址。

虚函数表和指针的结构关系如下图：

![](https://img-blog.csdnimg.cn/img_convert/be5535d6a10041a2497fde3bbb49140f.png)

其中：
- B的虚函数表中存放着B::foo和B::bar两个函数指针。
- D的虚函数表中存放的既有继承自B的虚函数B::foo，又有重写（override）了基类虚函数B::bar的D::bar，还有新增的虚函数D::quz。

从编译器的角度来说，B的虚函数表很好构造，D的虚函数表构造过程相对复杂。下面给出了构造D的虚函数表的一种方式（仅供参考）：

![](https://img-blog.csdnimg.cn/img_convert/e896e9c47bd35d9417e7d4058238cc68.png)

函数是怎样调用的呢？

定义一个父类的指针或者引用，C++允许父类的指针或者引用指向不同的子类对象，传递进去的实参就决定了调用哪个版本的bar函数。

![](https://img-blog.csdnimg.cn/img_convert/1849690c92a3b18be7fd69a253d5bc6a.png)

特别地，当一个类继承多个类，且多个基类都有虚函数时，子类对象中将包含多个虚函数表的指针（即多个vptr），如下图所示

![](https://img-blog.csdnimg.cn/img_convert/06372c6d8aff35b2109680d35e36f2b6.png)

函数是怎样调用的呢？

定义一个父类的指针或者引用，C++允许父类的指针或者引用指向不同的子类对象，传递进去的实参就决定了调用哪个版本的bar函数。

![](https://img-blog.csdnimg.cn/img_convert/d517cb63e52cfdae382fd4fd17092403.png)

# 总结多态  

第一：实现多态，必须要有继承，没有继承就没有多态  
第二：在继承的基础上，子类必须重写父类的同名方法，而且父类的同名方法必须定义成虚函数  
第三：虚函数是为多态而生的

# 多态的分类  

C++中总共有两种多态  
1. 编译时多态 --》指的就是我们前面学习过的函数重载  
2. 运行时多态 --》指的就是现在我们学习的利用虚函数实现的这种多态