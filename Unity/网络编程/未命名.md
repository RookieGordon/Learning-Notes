---
tags:
  - Netcode
  - Photon
  - Mirror
  - SmartFoxServer
  - LiteNetLib
  - ENet
  - KCP
  - Zookeeper
  - Wireshark
---
你说得很对，对于游戏开发来说，HTTP协议（包括HTTP/2、gRPC等框架）在实时性要求较高的场景（如多人在线联机、实时同步）并不理想，尤其是需要低延时或可靠传输的游戏场景（例如在线竞技游戏、MMORPG）。更合适的应该是基于 TCP 或 UDP 的解决方案。以下是适合 游戏开发 的网络优化框架和工具：

# 游戏开发常用的实时通信框架
## Netcode for GameObjects （Unity官方）
地址: [Netcode GitHub](https://github.com/Unity-Technologies/com.unity.netcode.gameobjects)
功能: Unity官方的网络同步框架，基于UDP通信，可快速实现客户端到服务器的实时数据同步。
适用场景: Unity引擎开发的多人实时网游，适合小型到中型的多人游戏项目。
特点:
提供RPC、网络变量等功能，便于游戏逻辑实现。
内置延迟模拟和容错机制。
## Photon Quantum / Photon Realtime / Photon Fusion
地址: [Photon 官网](https://www.photonengine.com/)
功能: 专为游戏开发设计的实时通信框架，适用于多人在线、实时同步、回合制以及MOBA类游戏。
适用场景: Unity、Unreal引擎开发的多人在线游戏，支持全球多数据中心。
特点:
Quantum 提供无锁帧同步机制，用于帧同步游戏（如竞技类游戏）。
Realtime 比较适合轻量型游戏，快速构建多人匹配。
Fusion 使用UDP协议进行高性能同步，支持多种网络延迟优化策略。
## Mirror
地址: [Mirror GitHub](https://github.com/MirrorNetworking/Mirror)
功能: Unity上的轻量级网络通信框架，基于UDP协议，支持常见的多人实时同步场景。
适用场景: Unity开发的多人游戏，比如MMORPG、MOBA。
特点:
容易上手，开源免费。
相比Photon更灵活、更自由。
## SmartFoxServer 2X
地址: [SmartFoxServer 官网](https://www.smartfoxserver.com/)
功能: 基于TCP和UDP双栈的实时游戏服务器解决方案。
适用场景: MMORPG、大型多人在线休闲、竞技和社交类游戏。
优点:
提供房间管理、匹配逻辑和持久化等功能，减少服务器开发工作量。
合适的状态同步和实时通信。
# 低延迟通信框架适合游戏开发
## ENet
地址: [ENet GitHub](https://github.com/lsalzman/enet)
功能: 基于UDP的可靠游戏网络传输库，支持低延迟和可靠的数据传输。
适用场景: 实时性要求高的多人在线游戏（如FPS、RTS、竞技类游戏）。
优点:
轻量、高效，解决了UDP默认无可靠性的问题（提供可靠包、无序包支持）。
适合实现类似QUIC协议的高效通信。
ENet是一个基于UDP的可靠通信网络框架，非常适合实时性要求高的应用（如竞技游戏、在线多人游戏）。它在设计上对网络波动（如丢包、延迟、抖动）有一定的优化手段。以下是ENet如何优化网络环境并降低网络波动影响的分析：

### 核心设计理念：UDP + 可靠机制
UDP通信：本身速度快，延迟低，但UDP原生是不可靠的。ENet在UDP基础上加了一个轻量级的可靠性和有序传输层，解决了TCP的冗余问题（如慢启动、僵化的拥塞控制等）。
优化点：
- 弥补了UDP对丢包、乱序以及网络波动的处理能力。
- 消除了TCP头部开销，让协议更轻量化，适合实时应用。
### 可靠传输 + 无序传输
ENet通过将传输数据分为以下两种类型，应对不同的重要性和实时性需求：
- 可靠传输（Reliable Packet Delivery）：
	- 保证重要数据的可靠性，丢包时会重传，确保这些数据最终到达。
	- 适用：游戏中的状态同步、重要事件、消息指令。
- 不可靠传输（Unreliable Packet Delivery）：
	- 无需可靠传输的场景（如实时性优先的游戏数据），适当丢包不会有明显影响。
	- 适用：物体瞬时状态（如角色位置、子弹轨迹）等短时过期的数据，不需要重传。
如何降低影响：
- 对实时性要求的数据（比如玩家坐标更新）使用不可靠传输，减少网络波动对延迟的影响。
- 对关键信息（如动作开始指令、状态变化）使用可靠传输，确保一定会到达。
### 自适应重传机制
ENet通过一种动态的 RTT（Round Trip Time）估算机制 来调整网络的重传行为，减少丢包和延迟的影响：
- 动态RTT延迟控制：
	- ENet会连续监测数据包的RTT变化，通过平滑算法（如加权移动平均）来准确响应网络波动。
	- 当网络延迟波动较大时，它会自动放宽超时时间，避免误判导致不必要的重传。
- 分段重传（Fragmented Packet Retransmission）：
	- 如果一次传输的包很大（如场景加载、大型事件），ENet支持将包分成更小的片段发送，只针对丢失的片段进行重传，而不是整个包。
	- 优点：减少了重传的数据量，降低宽带占用，提高传输效率。

### 自行实现的拥塞控制机制
相比于TCP，ENet使用了更轻量级的拥塞控制机制，以适应游戏网络的特性：
- 自适应流量控制：
	- ENet会根据网络丢包率和RTT变化动态调整发送窗口的大小。
	- 避免在网络波动时发送过多数据，从而造成队列中积压或阻塞。
- 丢包预测：
	- 在高丢包环境中，ENet限制过多的可靠消息重传，优先维持“连接的流畅性”。
降低影响：
- 通过这种轻量级的拥塞控制，ENet可以最大程度避免在网络拥堵时因为拥塞算法（TCP会导致周期性断流）引起的延迟爆炸。
#### 数据包排序和乱序包丢弃
网络波动常常会造成UDP包乱序到达，这可能影响游戏数据的处理。ENet通过以下机制优化：
- 重构数据包顺序：
	- ENet内置有序的包序列化机制（packet sequencing），会对乱序的数据包重新排序。
	- ENet会优先处理到达顺序符合预期的数据包，乱序数据也可以尽量纠正，避免破坏“场景更新”的连续性。
- 乱序包丢弃：
	- 如果乱序明显且不可补救，ENet可以丢弃乱序包而直接忽略，避免影响客户端体验。
	- 应用场景：不需要的数据补偿场景（如子弹弹道更新延帧）。
降低影响：
- 数据乱序得到恢复或控制时，客户端与服务器的状态一致性能更好地保障，即使网络波动也不会有显著问题。
### 每连接多通道通信支持
ENet支持在一个连接中划分多个虚拟通道，针对不同优先级的数据分配不同的传输策略：
- 支持多通道（Channels）：
	- 可以为不同的游戏数据指定不同的通道（如低优先级的动画动作数据，高优先级的战斗操作数据）。
	- 高优先级数据可以走可靠+低延时传输，而低优先级则可走不可靠通道，不会相互影响。
- 缓解网络竞争：
	- 在网络抖动情况下，低优先级数据的丢失不会影响高优先级数据的传输。
### 低延迟心跳机制
ENet定期通过心跳包检测连接是否存活，同时动态调整连接状态：

心跳包的延迟非常低，不会影响正常数据传输。
当检测网络状态恶化（如严重延迟或丢包）时，可以提醒客户端切换到备用网络通道（比如切换到更优质量的Wi-Fi或4G信号）。
防止因假断开（如瞬时丢包）导致的连接断裂。


8. QoS (服务质量)支持
ENet支持根据场景调整数据包的优先级和可靠性，灵活适应不同网络环境：

高质量网络：可以增大发送窗口、提高数据吞吐量，充分利用带宽。
弱网络：降低包的发送频率，优先发送重要数据。


典型场景的应用示例

角色状态同步：

使用不可靠消息通道发送角色坐标、朝向等高频更新数据。
应对丢包：丢失的状态更新直接被忽略，使用下一帧的数据进行补偿，确保流畅度。


重要事件（如技能释放、击杀通知）：

使用可靠传输通道，确保这些关键信息一定到达客户端，即便因网络波动稍微延迟。


战场广播：

通过分段重传将大型广播数据（如场景初始化、战场状态）拆分小包，仅对丢失的片段进行补发。


弱网优化（如丢包率超过20%）：

限制体积较大的可靠包的发送频率，动态调整发送窗口，避免因高丢包导致反馈阻塞。




总结
ENet通过以下几点降低网络波动对实时游戏的影响：

基于UDP的可靠传输机制，克服UDP不可靠的天然缺点。
自适应RTT与拥塞控制，针对网络波动动态调整发送速度。
多通道支持与动态优先级，为关键数据分配更高传输优先权。
智能包重传与分段传输，防止因大包丢失影响游戏性能。

它是轻量、高效、定制性强的框架，特别适合延迟敏感和带宽受限的多人在线游戏。值得你考虑！

## LiteNetLib
地址: [LiteNetLib GitHub](https://github.com/RevenantX/LiteNetLib)
功能: 高性能跨平台的UDP通信框架，用于高并发游戏和实时通信。
适用场景: 主打中小型多人游戏，如联机小游戏或轻竞技类游戏。
特点:
跨平台，支持Unity。
调度灵活，内存开销小。
提供可靠性功能，解决丢包问题。
## KCP
地址: [KCP GitHub](https://github.com/skywind3000/kcp)
功能: 基于UDP的可靠传输协议，非常适合作为网络通信底层。
适用场景: 超低延迟需求的在线PVP游戏、竞技游戏（FPS/RTS）。
优点:
高效、轻量，特别适合游戏服务器和移动终端。
底层协议可以和你设计的上层逻辑无缝结合。
典型应用案例:
众多手游服务器使用KCP做网络骨干（如网易《阴阳师》的早期场景）。
# 分布式与后端服务支持类
## Zookeeper
地址: [Zookeeper GitHub](https://github.com/apache/zookeeper)
功能: 分布式协调服务，适合游戏的分布式架构，实现负载均衡、房间匹配、状态管理。
适用场景: 大型网游的游戏后端服务，如多区域服务器的玩家路由。
# 开发和测试辅助工具
## Wireshark
地址: [Wireshark 官网](https://www.wireshark.org/)
功能: 网络数据包嗅探与分析工具，方便排查网络传输中的问题。
适用场景: 分析游戏中的延迟、丢包、协议栈问题。
## pufferpanel（轻量级服务器面板）
地址: pufferpanel GitHub
功能: 游戏服务器的管理工具，支持分布式部署。
适用场景: 管理多人在线的游戏服务器。
# 选择建议
大型游戏（如MMORPG、竞技类游戏）：
网络框架：KCP 或 Photon Quantum/Fusion。
服务端支持：SmartFoxServer 或分布式架构（Zookeeper + Redis）。
缓存支持：Redis 实时记录玩家在线状态及排行榜。
中小型多人游戏（匹配+多人在线）：
网络框架：ENet 或 LiteNetLib（推荐高效率UDP）。
框架：如 Mirror（Unity轻量级），或搭建 Photon Realtime/Fusion。
CDN 支持：加速静态资源如地图、皮肤包。
实时性强的竞技对战或PVP游戏（FPS/RTS类）：
使用基于UDP的 ENet 或 KCP。
如果是帧同步游戏，推荐 Photon Quantum。
