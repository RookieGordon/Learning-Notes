---
tags:
  - Unity
  - 战斗系统
  - 帧同步
---

# 相同的输入
## 管理输入

使用`BattleInputManager`管理输入，基本结构如下：
![[Pasted image 20240813093233.png]]
### 输入结构
`InputCmd`是用户输入的结构。其中，`CmdType`和`CmdValue`字段用于数据传输，其他字段用于关联输入角色。

### 帧输入结构
`FrameInput`用一个字典`_pDictPlayerIdToInputCmd`管理当前帧的输入。
对同一个角色添加操作命令时，同种命令，直接覆盖
```CSharp
private void _AddCmd(long p_lRoleId, InputCmd p_pCmd) {  
    if (!_pDictPlayerIdToInputCmd.TryGetValue(p_lRoleId, out var t_listCmd))  
    {        
	    t_listCmd = new List<InputCmd> { p_pCmd };  
        _pDictPlayerIdToInputCmd.Add(p_lRoleId, t_listCmd);  
    }    
    else  
    {  
        for (int i = 0, imax = t_listCmd.Count; i < imax; ++i)   
        {  
	        // 判断该命令是否需要被移除，同类型的命令会覆盖之前的
            if (_CheckIsRepeat(t_listCmd[i], p_pCmd))  
            {                
	            _pInputCmdPool?.Recycle(t_listCmd[i]);  
                t_listCmd.RemoveAt(i);  
                --i;  
                --imax;  
            }        
        }        
        t_listCmd.Add(p_pCmd);  
    }
}
```

### 管理帧输入

`BattleInputManager`在`FrameBegin`方法中，清理所有集合中的数据。在`FrameEnd`方法中，打包输入数据发送给服务器。



## 同步输入



# 相同的处理


# 相同的输出

